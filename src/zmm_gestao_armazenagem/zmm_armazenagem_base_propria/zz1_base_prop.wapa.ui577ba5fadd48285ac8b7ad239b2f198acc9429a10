var that;                                                                                                                                                                                                                                                      
sap.ui.define([&nbsp;                                                                                                                                                                                                                                          
    './ValueHelpExt.controller',                                                                                                                                                                                                                               
    './ValueHelpBpClienteExt.controller',                                                                                                                                                                                                                      
    './ValueHelpModalidaFreteExt.controller',                                                                                                                                                                                                                  
    './ValueHelpAgenteFreteExt.controller',                                                                                                                                                                                                                    
    'sap/ui/comp/library',                                                                                                                                                                                                                                     
	'sap/ui/core/mvc/Controller',                                                                                                                                                                                                                                 
	'sap/ui/model/type/String',                                                                                                                                                                                                                                   
	'sap/m/ColumnListItem',                                                                                                                                                                                                                                       
	'sap/m/Label',                                                                                                                                                                                                                                                
	'sap/m/SearchField',                                                                                                                                                                                                                                          
	'sap/m/Token',                                                                                                                                                                                                                                                
	'sap/ui/model/Filter',                                                                                                                                                                                                                                        
	'sap/ui/model/FilterOperator',                                                                                                                                                                                                                                
	'sap/ui/model/odata/v2/ODataModel',                                                                                                                                                                                                                           
	'sap/ui/table/Column',                                                                                                                                                                                                                                        
	'sap/m/Column',                                                                                                                                                                                                                                               
	'sap/m/Text',                                                                                                                                                                                                                                                 
], function(ValueHelpExt, ValueHelpBpClienteExt, ValueHelpModalidaFreteExt, ValueHelpAgenteFreteExt, compLibrary, Controller, TypeString, ColumnListItem, Label, SearchField, Token, Filter, FilterOperator, ODataModel, UIColumn, MColumn, Text) {            
    'use strict';                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
    return {                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
        onInit: function () {                                                                                                                                                                                                                                  
            that = this;                                                                                                                                                                                                                                       
		},                                                                                                                                                                                                                                                           
        gravaMotivo: function(oInput) {                                                                                                                                                                                                                        
            var i18nTxt = that.getView().getModel("i18n").getResourceBundle();                                                                                                                                                                                 
            var oBindingContext = oInput.getBindingContext();                                                                                                                                                                                                  
            var vNewUsedStock = oInput.getValue();                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
            if(oBindingContext.getObject().MaterialDocumentRetorno != ""){                                                                                                                                                                                     
                sap.m.MessageBox.warning(i18nTxt.getText("msgErroCampoEditavel"));                                                                                                                                                                             
                return null;                                                                                                                                                                                                                                   
            }                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
            /* ===================================================================&nbsp;                                                                                                                                                                       
            Chama Action no Behavior da CDS&nbsp;                                                                                                                                                                                                              
            =================================================================== */                                                                                                                                                                             
            var fnFunction = function () {                                                                                                                                                                                                                     
                return new Promise(function (fnResolve, fnReject) {                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                    that.extensionAPI.invokeActions(                                                                                                                                                                                                           
                        "/motivo",                                                                                                                                                                                                                             
                       oBindingContext,                                                                                                                                                                                                                        
                        {                                                                                                                                                                                                                                      
                           "motivoparam": vNewUsedStock                                                                                                                                                                                                        
                        },&nbsp;                                                                                                                                                                                                                               
                    ).then(function (data) {                                                                                                                                                                                                                   
                        fnResolve();                                                                                                                                                                                                                           
                        that.templateBaseExtension.getExtensionAPI().refreshTable();                                                                                                                                                                           
                        that.getView().getModel().refresh();                                                                                                                                                                                                   
                    }).catch(                                                                                                                                                                                                                                  
                        function(oError){&nbsp;                                                                                                                                                                                                                
                            fnReject();                                                                                                                                                                                                                        
                        }                                                                                                                                                                                                                                      
                    );                                                                                                                                                                                                                                         
                });                                                                                                                                                                                                                                            
            }                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
            var mParameters = {                                                                                                                                                                                                                                
                busy: {                                                                                                                                                                                                                                        
                    set: true,                                                                                                                                                                                                                                 
                    check: false                                                                                                                                                                                                                               
                },                                                                                                                                                                                                                                             
                dataloss: {                                                                                                                                                                                                                                    
                    popup: false,                                                                                                                                                                                                                              
                    navigation: false                                                                                                                                                                                                                          
                }                                                                                                                                                                                                                                              
            };                                                                                                                                                                                                                                                 
            this.extensionAPI.securedExecution(fnFunction, mParameters);                                                                                                                                                                                       
        },                                                                                                                                                                                                                                                     
        gravaQtdReceb: function(oInput) {                                                                                                                                                                                                                      
            var i18nTxt = that.getView().getModel("i18n").getResourceBundle();                                                                                                                                                                                 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                       
            let oTableLinePOPUP = oInput.getBindingContext().getObject();   /// com o evento seleciona a linha da Tabela do popup                                                                                                                              
            let oTableReport = this.templateBaseExtension.getExtensionAPI().getSelectedContexts(); /// tabela com os campos selecionados da tabela principal                                                                                                   
                                                                                                                                                                                                                                                               
            let vNewUsedStock =  oInput.getValue();                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
            let oTableLineReport = oTableReport.filter(ctx => {     ///pega a chave da linha do popup onde editou o campo, e busca os dados da tabela principal                                                                                                
                return ctx.getObject().MaterialDoc === oTableLinePOPUP.MaterialDoc &&&nbsp;                                                                                                                                                                    
                       ctx.getObject().MaterialDocItem === oTableLinePOPUP.MaterialDocItem &&&nbsp;                                                                                                                                                            
                       ctx.getObject().MaterialDocYear === oTableLinePOPUP.MaterialDocYear;                                                                                                                                                                    
            });                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
            if( vNewUsedStock > oTableLineReport[0].getObject().QtdReceb){  //se a quantidade editada for maior. pega atualiza com o valor antigo                                                                                                              
                                                                                                                                                                                                                                                               
                oInput.setValue(oTableLineReport[0].getObject().QtdReceb);                                                                                                                                                                                     
                sap.m.MessageBox.warning(i18nTxt.getText("msgErroCampoEditavelPOPUP"));                                                                                                                                                                        
                return null;                                                                                                                                                                                                                                   
            }                                                                                                                                                                                                                                                  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                       
        },                                                                                                                                                                                                                                                     
        onChangeMotivo: function(oEvent) {                                                                                                                                                                                                                     
            let oInput = oEvent.getSource();                                                                                                                                                                                                                   
            this.gravaMotivo(oInput);                                                                                                                                                                                                                          
        },                                                                                                                                                                                                                                                     
        onChangeQtdReceb: function (oEvent) {                                                                                                                                                                                                                  
            let oInput = oEvent.getSource();                                                                                                                                                                                                                   
            that.gravaQtdReceb(oInput);        },                                                                                                                                                                                                              
        onChangeQuantidade: function(oEvent) {                                                                                                                                                                                                                 
            var i18nTxt = that.getView().getModel("i18n").getResourceBundle();                                                                                                                                                                                 
            var oInput = oEvent.getSource();                                                                                                                                                                                                                   
            var oBindingContext = oEvent.getSource().getBindingContext();                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
            var vNewUsedStock = parseFloat( oInput.getValue() );                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
            if(oBindingContext.getObject().MaterialDocumentRetorno != ""){                                                                                                                                                                                     
                sap.m.MessageBox.warning(i18nTxt.getText("msgErroCampoEditavel"));                                                                                                                                                                             
                return null;                                                                                                                                                                                                                                   
            }                                                                                                                                                                                                                                                  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
            /* ===================================================================&nbsp;                                                                                                                                                                       
            Chama Action no Behavior da CDS&nbsp;                                                                                                                                                                                                              
            =================================================================== */                                                                                                                                                                             
            var fnFunction = function () {                                                                                                                                                                                                                     
                return new Promise(function (fnResolve, fnReject) {                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                    that.extensionAPI.invokeActions(                                                                                                                                                                                                           
                        "/descarga",                                                                                                                                                                                                                           
                       oBindingContext,                                                                                                                                                                                                                        
                        {                                                                                                                                                                                                                                      
                           "descarga": vNewUsedStock                                                                                                                                                                                                           
                        },&nbsp;                                                                                                                                                                                                                               
                    ).then(function (data) {                                                                                                                                                                                                                   
                        fnResolve();                                                                                                                                                                                                                           
                        that.templateBaseExtension.getExtensionAPI().refreshTable();                                                                                                                                                                           
                        that.getView().getModel().refresh();                                                                                                                                                                                                   
                    }).catch(                                                                                                                                                                                                                                  
                        function(oError){                                                                                                                                                                                                                      
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                       
                            //var error = oError.responseText;//.replaceAll('\\', '')                                                                                                                                                                          
                            //error.innererror.errordetails                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                            // var msgError = JSON.parse(oError[0].error.response.responseText);                                                                                                                                                               
                            // sap.m.MessageBox.error(msgError.error.message.value);                                                                                                                                                                           
                            fnReject();                                                                                                                                                                                                                        
                        }                                                                                                                                                                                                                                      
                    );                                                                                                                                                                                                                                         
                });                                                                                                                                                                                                                                            
            }                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
            var mParameters = {                                                                                                                                                                                                                                
                busy: {                                                                                                                                                                                                                                        
                    set: true,                                                                                                                                                                                                                                 
                    check: false                                                                                                                                                                                                                               
                },                                                                                                                                                                                                                                             
                dataloss: {                                                                                                                                                                                                                                    
                    popup: false,                                                                                                                                                                                                                              
                    navigation: false                                                                                                                                                                                                                          
                }                                                                                                                                                                                                                                              
            };                                                                                                                                                                                                                                                 
            this.extensionAPI.securedExecution(fnFunction, mParameters);                                                                                                                                                                                       
        },                                                                                                                                                                                                                                                     
        GerarRetornoArm: function(oEvent, oTable) {                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
            var BpCliente = sap.ui.getCore().byId('inBpCliente').getValue();&nbsp;                                                                                                                                                                             
            var ModalidadeFrete = sap.ui.getCore().byId('inModalidadeFrete').getValue();                                                                                                                                                                       
            var AgenteFrete = sap.ui.getCore().byId('inAgentedeFrete').getValue();                                                                                                                                                                             
            var Placa = sap.ui.getCore().byId('inPlaca').getValue();                                                                                                                                                                                           
            var InfoDanfe = sap.ui.getCore().byId('inInfoDanfe').getValue();                                                                                                                                                                                   
            let oExtApi = this.templateBaseExtension.getExtensionAPI();                                                                                                                                                                                        
            //let oCtx = this.templateBaseExtension.getExtensionAPI().getSelectedContexts();                                                                                                                                                                   
            let lTable = oTable.oModels.undefined.oData                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
            /* ===================================================================&nbsp;                                                                                                                                                                       
            Chama Action no Behavior da CDS&nbsp;                                                                                                                                                                                                              
            =================================================================== */                                                                                                                                                                             
            let i = 0;                                                                                                                                                                                                                                         
            var fnFunction = function () {&nbsp;                                                                                                                                                                                                               
                return new Promise(function (fnResolve, fnReject) {                                                                                                                                                                                            
                    for (let oCtx of oExtApi.getSelectedContexts()){                                                                                                                                                                                           
                        var promises = [];                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                        var promise = new Promise(function (fnRes, fnRej) {                                                                                                                                                                                    
                            that.extensionAPI.invokeActions(                                                                                                                                                                                                   
                                "/gerar_retorno",                                                                                                                                                                                                              
                                oCtx,                                                                                                                                                                                                                          
                                {&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                            
                                    InfoDanfe,                                                                                                                                                                                                                 
                                    Placa,                                                                                                                                                                                                                     
                                    ModalidadeFrete,                                                                                                                                                                                                           
                                    AgenteFrete,                                                                                                                                                                                                               
                                    BpCliente,                                                                                                                                                                                                                 
                                    QtdRes : lTable[i].QtdReceb                                                                                                                                                                                                
                                },&nbsp;                                                                                                                                                                                                                       
                            ).then(                                                                                                                                                                                                                            
                                function (data) {                                                                                                                                                                                                              
                                    fnRes();                                                                                                                                                                                                                   
                          //        fnRej();                                                                                                                                                                                                                   
                                    that.templateBaseExtension.getExtensionAPI().refreshTable();                                                                                                                                                               
                                    that.getView().getModel().refresh();                                                                                                                                                                                       
                            }).catch(                                                                                                                                                                                                                          
                                function(oError){&nbsp;&nbsp;                                                                                                                                                                                                  
                                    fnRej();                                                                                                                                                                                                                   
                                }                                                                                                                                                                                                                              
                            );                                                                                                                                                                                                                                 
                        });                                                                                                                                                                                                                                    
                        promises.push(promise);                                                                                                                                                                                                                
                        i++;                                                                                                                                                                                                                                   
                    }                                                                                                                                                                                                                                          
                    Promise.all(promises)                                                                                                                                                                                                                      
                    .then( function (data) {                                                                                                                                                                                                                   
                        fnResolve();                                                                                                                                                                                                                           
                    //  fnReject();                                                                                                                                                                                                                            
                        that.templateBaseExtension.getExtensionAPI().refreshTable();                                                                                                                                                                           
                        that.getView().getModel().refresh();                                                                                                                                                                                                   
                    })                                                                                                                                                                                                                                         
                    .catch( function(oError){&nbsp;&nbsp;                                                                                                                                                                                                      
                        fnReject();                                                                                                                                                                                                                            
                    });                                                                                                                                                                                                                                        
                });&nbsp;                                                                                                                                                                                                                                      
            }                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
            var mParameters = {                                                                                                                                                                                                                                
                busy: {                                                                                                                                                                                                                                        
                    set: true,                                                                                                                                                                                                                                 
                    check: false                                                                                                                                                                                                                               
                },                                                                                                                                                                                                                                             
                dataloss: {                                                                                                                                                                                                                                    
                    popup: false,                                                                                                                                                                                                                              
                    navigation: false                                                                                                                                                                                                                          
                }                                                                                                                                                                                                                                              
            };                                                                                                                                                                                                                                                 
            this.extensionAPI.securedExecution(fnFunction, mParameters);                                                                                                                                                                                       
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                       
        },&nbsp;                                                                                                                                                                                                                                               
        onGerarRetornoArm: function(oEvent) {                                                                                                                                                                                                                  
            this.classe = this;                                                                                                                                                                                                                                
            // var bwart = 'Z12';                                                                                                                                                                                                                              
            /// Textos i18n //////////////////////////////////////////////////////////////////////////////                                                                                                                                                     
            var i18nTxt = that.getView().getModel("i18n").getResourceBundle();                                                                                                                                                                                 
            //////////////////////////////////////////////////////////////////////////////////////////////                                                                                                                                                     
                                                                                                                                                                                                                                                               
            let oExtApi = this.templateBaseExtension.getExtensionAPI();                                                                                                                                                                                        
            // get the Model reference                                                                                                                                                                                                                         
            var oModel = this.getView().getModel();                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
            let oCtx = this.templateBaseExtension.getExtensionAPI().getSelectedContexts();                                                                                                                                                                     
            let BpCliente = oExtApi.getSelectedContexts()[0].getObject().BusinessPartner;&nbsp;&nbsp;                                                                                                                                                          
                                                                                                                                                                                                                                                               
            ///// Inicio da criao do POP UP                                                                                                                                                                                                                  
            var oContent = new sap.ui.layout.VerticalLayout({                                                                                                                                                                                                  
                width: '100%',                                                                                                                                                                                                                                 
                content: [                                                                                                                                                                                                                                     
                    new sap.m.Label({ text: i18nTxt.getText("LblBpCliente") }),                                                                                                                                                                                
                    new sap.m.Input('inBpCliente', {                                                                                                                                                                                                           
                        width: '100%',                                                                                                                                                                                                                         
                        maxLength: 10,                                                                                                                                                                                                                         
                        value : BpCliente,                                                                                                                                                                                                                     
                        showValueHelp: true,                                                                                                                                                                                                                   
                        valueHelpRequest: () => { that.valueHelpBpCliente(that) }                                                                                                                                                                              
                    }),                                                                                                                                                                                                                                        
                    new sap.m.Label({ text: i18nTxt.getText("LblModalidadeFrete") }),                                                                                                                                                                          
                    new sap.m.Input('inModalidadeFrete', {                                                                                                                                                                                                     
                        width: '100%',                                                                                                                                                                                                                         
                        maxLength: 1,                                                                                                                                                                                                                          
                        showValueHelp: true,                                                                                                                                                                                                                   
                        valueHelpRequest: () => { that.ValueHelpModalidaFrete(that) }                                                                                                                                                                          
                    }),                                                                                                                                                                                                                                        
                    new sap.m.Label({ text: i18nTxt.getText("LblAgentedeFrete") }),                                                                                                                                                                            
                    new sap.m.Input('inAgentedeFrete', {                                                                                                                                                                                                       
                        width: '100%',                                                                                                                                                                                                                         
                        maxLength: 10,                                                                                                                                                                                                                         
                        showValueHelp: true,                                                                                                                                                                                                                   
                        valueHelpRequest: () => { that.valueHelpAgente(that) }                                                                                                                                                                                 
                    }),                                                                                                                                                                                                                                        
                    new sap.m.Label({ text: i18nTxt.getText("LblPlaca") }),                                                                                                                                                                                    
                    new sap.m.Input('inPlaca', {                                                                                                                                                                                                               
                        width: '100%',                                                                                                                                                                                                                         
                        maxLength: 7,                                                                                                                                                                                                                          
                        showValueHelp: false                                                                                                                                                                                                                   
                    })                                                                                                                                                                                                                                         
                ]                                                                                                                                                                                                                                              
            })&nbsp;                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
            // Criar a tabela                                                                                                                                                                                                                                  
            var oTable = new sap.m.Table({                                                                                                                                                                                                                     
                inset: false,                                                                                                                                                                                                                                  
                headerToolbar: new sap.m.Toolbar({                                                                                                                                                                                                             
                    content: [                                                                                                                                                                                                                                 
                        new sap.m.Title({ text: i18nTxt.getText("LblTitulo") })                                                                                                                                                                                
                    ]                                                                                                                                                                                                                                          
                }),                                                                                                                                                                                                                                            
                columns: [                                                                                                                                                                                                                                     
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                       
                    new sap.m.Column({                                                                                                                                                                                                                         
                        header: new sap.m.Label({ text: i18nTxt.getText("LblNfeRemessa") }),                                                                                                                                                                   
                        width : "20%"                                                                                                                                                                                                                          
                    }),                                                                                                                                                                                                                                        
                    new sap.m.Column({                                                                                                                                                                                                                         
                        header: new sap.m.Label({ text: i18nTxt.getText("LblMaterial") })                                                                                                                                                                      
                    }),                                                                                                                                                                                                                                        
                    new sap.m.Column({                                                                                                                                                                                                                         
                        header: new sap.m.Label({ text: i18nTxt.getText("LblQuantidade") }),                                                                                                                                                                   
                        hAlign: "Right"                                                                                                                                                                                                                        
                    })                                                                                                                                                                                                                                         
                ]                                                                                                                                                                                                                                              
            });                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
            // Criar os itens da tabela e vincular os dados                                                                                                                                                                                                    
            var oColumnListItem = new sap.m.ColumnListItem({                                                                                                                                                                                                   
                cells: [                                                                                                                                                                                                                                       
                    new sap.m.ObjectStatus({&nbsp;                                                                                                                                                                                                             
                        text: "{NfeRemessa}",&nbsp;                                                                                                                                                                                                            
                        state: "{= ${PerdaGanho} < 0 ? 'Error' : 'Success' }"&nbsp;&nbsp;                                                                                                                                                                      
                    }),                                                                                                                                                                                                                                        
                    new sap.m.ObjectStatus({&nbsp;                                                                                                                                                                                                             
                        text: "{Material} - {MaterialName}",&nbsp;                                                                                                                                                                                             
                        state: "{= ${PerdaGanho} < 0 ? 'Error' : 'Success' }"&nbsp;&nbsp;                                                                                                                                                                      
                    }),                                                                                                                                                                                                                                        
                    new sap.m.Input({&nbsp;                                                                                                                                                                                                                    
                        value: "{QtdReceb}",                                                                                                                                                                                                                   
                        editable: true,                                                                                                                                                                                                                        
                        textAlign: "Right",                                                                                                                                                                                                                    
                        change: that.onChangeQtdReceb                                                                                                                                                                                                          
                    })                                                                                                                                                                                                                                         
                ]                                                                                                                                                                                                                                              
            });                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
            oTable.bindAggregation("items", {                                                                                                                                                                                                                  
                path: "/",                                                                                                                                                                                                                                     
                template: oColumnListItem                                                                                                                                                                                                                      
            });                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
            // Definir o modelo de dados da tabela com os dados obtidos de oCtx                                                                                                                                                                                
            oTable.setModel(new sap.ui.model.json.JSONModel(oCtx.map(ctx => ctx.getObject())));                                                                                                                                                                
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                       
            // Envolver a tabela em um ScrollContainer para adicionar uma barra de rolagem                                                                                                                                                                     
            var oScrollContainer = new sap.m.ScrollContainer({                                                                                                                                                                                                 
                vertical: true,                                                                                                                                                                                                                                
                height: "300px",                                                                                                                                                                                                                               
                content: oTable                                                                                                                                                                                                                                
            });                                                                                                                                                                                                                                                
&nbsp;                                                                                                                                                                                                                                                         
            oContent.addContent(oScrollContainer);                                                                                                                                                                                                             
            oContent.addContent(new sap.m.Label({ text: i18nTxt.getText("LblInfoDanfe") }));&nbsp;                                                                                                                                                             
            oContent.addContent( new sap.m.TextArea('inInfoDanfe', {                                                                                                                                                                                           
                width: '100%',                                                                                                                                                                                                                                 
                rows: 5, // Define a quantidade de linhas do campo de texto&nbsp;                                                                                                                                                                              
            }));                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
            var pressDialog = new sap.m.Dialog({                                                                                                                                                                                                               
                type: 'Message',                                                                                                                                                                                                                               
                title: i18nTxt.getText("BtnGerarRetorno"),                                                                                                                                                                                                     
                resizable: true,                                                                                                                                                                                                                               
                draggable: true,                                                                                                                                                                                                                               
                titleAlignment: sap.m.TitleAlignment.Left,                                                                                                                                                                                                     
                content: oContent,                                                                                                                                                                                                                             
                beginButton: new sap.m.Button({                                                                                                                                                                                                                
                    type: sap.m.ButtonType.Emphasized,                                                                                                                                                                                                         
                    text: i18nTxt.getText("BtnGerarRetorno"),                                                                                                                                                                                                  
                    press: async function () {                                                                                                                                                                                                                 
                        var res = await that.GerarRetornoArm(oEvent, oTable);                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                        pressDialog.close();&nbsp;                                                                                                                                                                                                             
                        pressDialog.destroy();                                                                                                                                                                                                                 
                    }                                                                                                                                                                                                                                          
                }),                                                                                                                                                                                                                                            
                endButton: new sap.m.Button({                                                                                                                                                                                                                  
                    text: i18nTxt.getText("LblCancelar"),                                                                                                                                                                                                      
                    press: function () {                                                                                                                                                                                                                       
                        pressDialog.close();                                                                                                                                                                                                                   
                    }                                                                                                                                                                                                                                          
                }),                                                                                                                                                                                                                                            
                afterClose: function () {                                                                                                                                                                                                                      
                    pressDialog.destroy();                                                                                                                                                                                                                     
                },                                                                                                                                                                                                                                             
                contentWidth: "50%",                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
            });                                                                                                                                                                                                                                                
            pressDialog.open();                                                                                                                                                                                                                                
		},                                                                                                                                                                                                                                                           
        onEstorno: function(oEvent) {                                                                                                                                                                                                                          
            var i18nTxt = this.getView().getModel("i18n").getResourceBundle();                                                                                                                                                                                 
            let oExtApi = this.templateBaseExtension.getExtensionAPI();                                                                                                                                                                                        
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                             
            let oCtx = this.templateBaseExtension.getExtensionAPI().getSelectedContexts();                                                                                                                                                                     
&nbsp;                                                                                                                                                                                                                                                         
            if ((oCtx.length > 1)){                                                                                                                                                                                                                            
                sap.m.MessageBox.warning(i18nTxt.getText("txtSingleLine"));                                                                                                                                                                                    
                return;                                                                                                                                                                                                                                        
            }                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
            var Docnum, Bukrs, DataDocInicio, DataDocFim;                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
            for (let oCtx of oExtApi.getSelectedContexts()){                                                                                                                                                                                                   
                Docnum = oCtx.getObject().BR_NotaFiscal;&nbsp;&nbsp;                                                                                                                                                                                           
                Bukrs  = oCtx.getObject().Empresa;                                                                                                                                                                                                             
                DataDocInicio = ""&nbsp;                                                                                                                                                                                                                       
                DataDocFim = ""&nbsp;&nbsp;                                                                                                                                                                                                                    
            }                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
            var SemanticObject = "NotaFiscal";                                                                                                                                                                                                                 
            var Action = "monitor";&nbsp;                                                                                                                                                                                                                      
            var params = {&nbsp;                                                                                                                                                                                                                               
                    Docnum,                                                                                                                                                                                                                                    
                    Bukrs,&nbsp;                                                                                                                                                                                                                               
                    DataDocInicio,&nbsp;                                                                                                                                                                                                                       
                    DataDocFim                                                                                                                                                                                                                                 
                };                                                                                                                                                                                                                                             
            this.navigateTo(SemanticObject, Action, params );                                                                                                                                                                                                  
        },                                                                                                                                                                                                                                                     
        navigateTo: function (SemanticObject, Action, params) {                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
            /* ===================================================================&nbsp;                                                                                                                                                                       
            Verifica se usurio tem permisso para navegao&nbsp;                                                                                                                                                                                             
            =================================================================== */                                                                                                                                                                             
                                                                                                                                                                                                                                                               
            sap.ushell.Container.getService("CrossApplicationNavigation").isNavigationSupported([                                                                                                                                                              
                { target: { shellHash: SemanticObject + "-" + Action } }                                                                                                                                                                                       
            ])                                                                                                                                                                                                                                                 
                .done(function (aResponse) {                                                                                                                                                                                                                   
                    aResponse.map(function (elem, index) {                                                                                                                                                                                                     
                        if (elem.supported === true) {                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                            /* ===================================================================&nbsp;                                                                                                                                                       
                            Chama outro aplicativo&nbsp;                                                                                                                                                                                                       
                            =================================================================== */                                                                                                                                                             
                            var href_parameters = (sap.ushell && sap.ushell.Container &&                                                                                                                                                                       
                                sap.ushell.Container.getService("CrossApplicationNavigation").hrefForExternal({                                                                                                                                                
                                    target: { semanticObject: SemanticObject, action: Action },                                                                                                                                                                
                                    params : params                                                                                                                                                                                                            
                                }));                                                                                                                                                                                                                           
                            sap.m.URLHelper.redirect(href_parameters, false);                                                                                                                                                                                  
                        }                                                                                                                                                                                                                                      
                        else {                                                                                                                                                                                                                                 
                            sap.m.MessageBox.warning('Usurio sem permisso para acessar o link');                                                                                                                                                             
                        }                                                                                                                                                                                                                                      
                    })                                                                                                                                                                                                                                         
                })                                                                                                                                                                                                                                             
                .fail(function () {                                                                                                                                                                                                                            
                    sap.m.MessageBox.error('Falha ao acessar o link');                                                                                                                                                                                         
                });                                                                                                                                                                                                                                            
        },                                                                                                                                                                                                                                                     
        valueHelpMotivo: function (oEvent) {                                                                                                                                                                                                                   
            this._oInputMotivo = oEvent;                                                                                                                                                                                                                       
            this.pWhitespaceDialog = new ValueHelpExt.valueHelpContruct(oEvent, this);                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
        valueHelpBpCliente: function (that) {                                                                                                                                                                                                                  
            this._oInputUfDestino = sap.ui.getCore().byId('inBpCliente');                                                                                                                                                                                      
            this.pWhitespaceDialog = new ValueHelpBpClienteExt.valueHelpContruct(that);                                                                                                                                                                        
		},                                                                                                                                                                                                                                                           
        valueHelpAgente: function (that) {                                                                                                                                                                                                                     
            this._oInputUfDestino = sap.ui.getCore().byId('inAgentedeFrete');                                                                                                                                                                                  
            this.pWhitespaceDialog = new ValueHelpAgenteFreteExt.valueHelpContruct(that);                                                                                                                                                                      
		},                                                                                                                                                                                                                                                           
        ValueHelpModalidaFrete: function (that) {                                                                                                                                                                                                              
            this._oInputUfDestino = sap.ui.getCore().byId('inModalidadeFrete');                                                                                                                                                                                
            this.pWhitespaceDialog = new ValueHelpModalidaFreteExt.valueHelpContruct(that);                                                                                                                                                                    
		},                                                                                                                                                                                                                                                           
        onValueHelpDialogOk: function (oEvent) {                                                                                                                                                                                                               
           let input = this.pWhitespaceDialog.ValueHelpDialogOk(oEvent);&nbsp;                                                                                                                                                                                 
            this.gravaMotivo(input);                                                                                                                                                                                                                           
        },                                                                                                                                                                                                                                                     
        onValueHelpDialogPopUpRetornoRemessaOk: function (oEvent) {                                                                                                                                                                                            
            var value = this.pWhitespaceDialog.ValueHelpDialogOk(oEvent);&nbsp;                                                                                                                                                                                
            this._oInputUfDestino.setValue(value);&nbsp;&nbsp;                                                                                                                                                                                                 
        },                                                                                                                                                                                                                                                     
        onValueHelpDialogCancel: function (oEvent) {&nbsp;                                                                                                                                                                                                     
            this.pWhitespaceDialog.ValueHelpDialogCancel();&nbsp;&nbsp;                                                                                                                                                                                        
        },&nbsp;                                                                                                                                                                                                                                               
        onFilterBarSearch: function (oEvent) {                                                                                                                                                                                                                 
            this.pWhitespaceDialog.Search(oEvent);                                                                                                                                                                                                             
		},                                                                                                                                                                                                                                                           
        onInputSuggestionItemSelected: function (oEvent) {                                                                                                                                                                                                     
            this.pWhitespaceDialog.SuggestionItemSelected(oEvent);                                                                                                                                                                                             
		}                                                                                                                                                                                                                                                            
    };                                                                                                                                                                                                                                                         
});                                                                                                                                                                                                                                                            