var sLinha={};sap.ui.define(["./ValueHelpExt.controller","./ValueHelpBpClienteExt.controller","./ValueHelpBpClienteExt2.controller","./ValueHelpModalidaFreteExt.controller","sap/ui/comp/library","sap/ui/core/mvc/Controller","sap/ui/model/type/String","sa+
p/m/ColumnListItem","sap/m/Label","sap/m/SearchField","sap/m/Token","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/odata/v2/ODataModel","sap/ui/table/Column","sap/m/Column","sap/m/Text","sap/m/MessageToast","sap/m/PDFViewer"],function(+
e,t,n,a,i,o,s,r,l,u,p,c,g,h,d,m,f,v,x){"use strict";return{onInit:function(){this._oInputUfDestino2=""},getPDFData:function(e){var t=this.getView().getModel();let n=this.templateBaseExtension.getExtensionAPI().getSelectedContexts();return new Promise((e,+
a)=>{t.read("/PDF(DeliveryDocument='"+n[0].getObject().DeliveryDocument+"',DeliveryDocumentItem='"+n[0].getObject().DeliveryDocumentItem+"',qtdpopup='"+sap.ui.getCore().byId("inVolume").getValue()+"')/Set",{success:function(t,n){e(t)},error:function(e){a+
(e)}})})},onPopup:async function(e){var t=new x;this.getView().addDependent(t);var n=await this.getPDFData();if(n===""){sap.m.MessageBox.error("Erro ao gerar PDF");return}if(typeof n!=="undefined"){let e=n.results[0].stream_data;let s=atob(e);let r=new U+
int8Array(s.length);for(var a=0;a<s.length;a++){r[a]=s.charCodeAt(a)}var i=new Blob([r.buffer],{type:"application/pdf"});var o=URL.createObjectURL(i);jQuery.sap.addUrlWhitelist("blob");t.setSource(o);t.setVisible(true);t.setTitle("ND");t.open()}},onPDF:a+
sync function(e){let t=this.templateBaseExtension.getExtensionAPI().getSelectedContexts();if(t.length>1){sap.m.MessageBox.error("Selecionar apenas uma linha");return}if(t[0].getObject().semaforo===3){sap.m.MessageBox.error("Impossível selecionar linha de+
 ganho");return}var n=new sap.ui.layout.VerticalLayout({width:"100%",content:[new sap.m.Label({text:"Dias"}),new sap.m.Input("inVolume",{width:"100%",showValueHelp:false,type:"Number"})]});var a=new sap.m.Dialog({type:"Message",title:"Prazo de pagamento"+
,resizable:false,draggable:true,titleAlignment:sap.m.TitleAlignment.Left,content:n,beginButton:new sap.m.Button({type:sap.m.ButtonType.Emphasized,text:"Confirmar",press:function(){this.onPopup()}.bind(this)}),endButton:new sap.m.Button({text:"Cancelar",p+
ress:function(){a.close()}}),afterClose:function(){a.destroy()},contentWidth:"20%"});a.open()},whitespace2Char:function(e){var t=" ",n=" ";if(typeof e!=="string"){return e}return e.replaceAll(t+t,t+n)},valueHelpMotivo:function(e,t){this._oInputUfDestino2+
=e.getSource();var n=new f({text:{path:"motivomov"},renderWhitespace:true});sLinha=e.getSource().getBindingContext().getObject();this._oBasicSearchField2=new u({search:function(){this.oWhitespaceDialog2.getFilterBar().search()}.bind(this)});if(!this.pWhi+
tespaceDialog2){this.pWhitespaceDialog2=this.loadFragment({name:"br.com.simrede.mmbaseterceiro.ext.fragments.valueHelpMotivo"})}this.pWhitespaceDialog2.then(function(e){var t=e.getFilterBar();this.oWhitespaceDialog2=e;if(this._bWhitespaceDialogInitialize+
d2){e.open();return}this.getView().addDependent(e);t.setFilterBarExpanded(false);t.setBasicSearch(this._oBasicSearchField2);t.determineFilterItemByName("motivomov").getControl().setTextFormatter(this._inputTextFormatter);e.getTableAsync().then(function(t+
){t.setModel(this.oModel);t.setSelectionMode("Single");if(t.bindRows){t.addColumn(new d({label:"Motivo",template:n}));t.addColumn(new d({label:"Descrição",template:"Grtxt"}));t.bindAggregation("rows",{path:"/ZI_MM_VH_GRUND",events:{dataReceived:function(+
){e.update()}}})}if(t.bindItems){t.addColumn(new m({header:new l({text:"Motivo"})}));t.addColumn(new m({header:new l({text:"Descricao"})}));t.bindItems({path:"/ZI_MM_VH_GRUND",template:new r({cells:[new l({text:"{motivomov}"}),new l({text:"{Grtxt}"})]}),+
events:{dataReceived:function(){e.update()}}})}e.update()}.bind(this));this._bWhitespaceDialogInitialized2=true;e.open()}.bind(this))},onSearchMotivo:function(e){var t=this._oBasicSearchField2.getValue(),n=e.getParameter("selectionSet");var a=n.reduce(fu+
nction(e,t){if(t.getValue()){e.push(new c({path:t.getName(),operator:g.Contains,value1:t.getValue()}))}return e},[]);a.push(new c({filters:[new c({path:"motivomov",operator:g.Contains,value1:t}),new c({path:"Grtxt",operator:g.Contains,value1:t})],and:fal+
se}));this._filterTableMotivo(new c({filters:a,and:true}))},onSuggestionItemSelectedMotivo:function(e){var t=this.byId("inRegion").getValue();var n=this.byId("inRegionName").getValue();let a;if(t&&!n){a=[new c("motivomov",g.EQ,t)]}if(!t&&n){a=[new c("Grt+
xt",g.EQ,n)]}if(t&&n){a=[new c("motivomov",g.EQ,t),new c("Grtxt",g.EQ,n)]}this._filterTableMotivo(new c({filters:a,and:true}))},onCancelPressMotivo:function(e){this.oWhitespaceDialog2.close()},onOkPressMotivo:function(e){var t=e.getParameter("tokens");va+
r n;t.forEach(function(e){e.setText(this.whitespace2Char(e.getText()));n=e.getKey()}.bind(this));this._oInputUfDestino2.setValue(t[0].getKey());this.oWhitespaceDialog2.close();var a=this;var i=this._oInputUfDestino2.getBindingContext();var o=function(){r+
eturn new Promise(function(e,t){a.extensionAPI.invokeActions("/motivo",i,{motivoparam:n}).then(function(t){e();a.templateBaseExtension.getExtensionAPI().refreshTable();a.getView().getModel().refresh()})})};var s={busy:{set:true,check:false},dataloss:{pop+
up:false,navigation:false}};var r=this.extensionAPI.securedExecution(o,s)},onSubmitMotivo:function(e){let t=e.getParameters().value;var n=this;var a=e.getSource().getParent().sId;var i=e.getSource().getBindingContext();let o=this.getView().getModel();var+
 s=function(){return new Promise(function(e,t){n.extensionAPI.invokeActions("motivo",i,{motivomov:vNewUsedStock}).then(function(t){e();n.templateBaseExtension.getExtensionAPI().refreshTable();n.getView().getModel().refresh()})})};var r={busy:{set:true,ch+
eck:false},dataloss:{popup:false,navigation:false}};this.extensionAPI.securedExecution(s,r)},onliveChangeMotivo:function(e){var t=e.getSource();t.setValue(t.getValue().toUpperCase())},_filterTableMotivo:function(e){var t=this.oWhitespaceDialog2;t.getTabl+
eAsync().then(function(n){if(n.bindRows){n.getBinding("rows").filter(e)}if(n.bindItems){n.getBinding("items").filter(e)}t.update()})},onDescarga:function(e){var t=this;var n=e.getSource();var a=e.getSource().getBindingContext();var i=parseFloat(n.getValu+
e());var o=function(){return new Promise(function(e,n){t.extensionAPI.invokeActions("/descarga",a,{descarga:i}).then(function(n){e();t.templateBaseExtension.getExtensionAPI().refreshTable();t.getView().getModel().refresh()})})};var s={busy:{set:true,chec+
k:false},dataloss:{popup:false,navigation:false}};this.extensionAPI.securedExecution(o,s)},GerarRetornoArm:function(e){var t=this;var n=e.getSource();var a=e.getSource().getBindingContext();var i=sap.ui.getCore().byId("inBpCliente").getValue();var o=sap.+
ui.getCore().byId("inModalidadeFrete").getValue();var s=sap.ui.getCore().byId("inAgente").getValue();var r=sap.ui.getCore().byId("inPlaca").getValue();var l=sap.ui.getCore().byId("inInfoDanfe").getValue();let u=this.templateBaseExtension.getExtensionAPI(+
);let p=this.templateBaseExtension.getExtensionAPI().getSelectedContexts();var c=function(){return new Promise(function(e,n){for(let e of u.getSelectedContexts()){var a=[];var p=new Promise(function(n,a){t.extensionAPI.invokeActions("/gerar_retorno",e,{I+
nfoDanfe:l,Placa:r,Agente:s,ModalidadeFrete:o,BpCliente:i}).then(function(e){n();a();t.templateBaseExtension.getExtensionAPI().refreshTable();t.getView().getModel().refresh()}).catch(function(e){a()})});a.push(p)}Promise.all(a).then(function(a){e();n();t+
.templateBaseExtension.getExtensionAPI().refreshTable();t.getView().getModel().refresh()}).catch(function(e){n()})})};var g={busy:{set:true,check:false},dataloss:{popup:false,navigation:false}};this.extensionAPI.securedExecution(c,g)},onGerarRetornoArm:f+
unction(e){var t=this;var n=t.getView().getModel("i18n").getResourceBundle();let a=this.templateBaseExtension.getExtensionAPI();var i=this.getView().getModel();let o=this.templateBaseExtension.getExtensionAPI().getSelectedContexts();for(let e of a.getSel+
ectedContexts()){if(e.getObject().status!=="Remessa pendente"){sap.m.MessageBox.error("Selecionar apenas remessas pendentes");return}}var s=new sap.ui.layout.VerticalLayout({width:"100%",content:[new sap.m.Label({text:n.getText("LblBpCliente")}),new sap.+
m.Input("inBpCliente",{width:"100%",maxLength:10,showValueHelp:true,valueHelpRequest:()=>{t.valueHelpBpCliente(t)}}),new sap.m.Label({text:n.getText("LblModalidadeFrete")}),new sap.m.Input("inModalidadeFrete",{width:"100%",showValueHelp:true,valueHelpReq+
uest:()=>{t.ValueHelpModalidaFrete(t)}}),new sap.m.Label({text:n.getText("LblAgente")}),new sap.m.Input("inAgente",{width:"100%",maxLength:10,showValueHelp:true,valueHelpRequest:()=>{t.valueHelpBpCliente2(t)}}),new sap.m.Label({text:n.getText("LblPlaca")+
}),new sap.m.Input("inPlaca",{width:"100%",showValueHelp:false})]});var r=new sap.m.Table({inset:false,headerToolbar:new sap.m.Toolbar({content:[new sap.m.Title({text:n.getText("LblTitulo")})]}),columns:[new sap.m.Column({header:new sap.m.Label({text:n.g+
etText("LblMaterial")})}),new sap.m.Column({header:new sap.m.Label({text:n.getText("LblQuantidade")})}),new sap.m.Column({header:new sap.m.Label({text:n.getText("LblAviso")})})]});var l=new sap.m.ColumnListItem({cells:[new sap.m.ObjectStatus({text:"{Mate+
rial} - {MaterialName}",state:"{= ${PerdaGanho} < 0 ? 'Error' : 'Success' }"}),new sap.m.ObjectStatus({text:"{descarga}",state:"{= ${PerdaGanho} < 0 ? 'Error' : 'Success' }"}),new sap.m.ObjectStatus({text:"{DeliveryDocument}",state:"{= ${PerdaGanho} < 0 +
? 'Error' : 'Success' }"})]});r.bindAggregation("items",{path:"/",template:l});r.setModel(new sap.ui.model.json.JSONModel(o.map(e=>e.getObject())));var u=new sap.m.ScrollContainer({vertical:true,height:"300px",content:r});s.addContent(u);s.addContent(new+
 sap.m.Label({text:n.getText("LblInfoDanfe")}));s.addContent(new sap.m.TextArea("inInfoDanfe",{width:"100%",rows:5}));var p=new sap.m.Dialog({type:"Message",title:n.getText("BtnGerarRetorno"),resizable:false,draggable:true,titleAlignment:sap.m.TitleAlign+
ment.Left,content:s,beginButton:new sap.m.Button({type:sap.m.ButtonType.Emphasized,text:n.getText("BtnGerarRetorno"),press:async function(){var n=await t.GerarRetornoArm(e);p.close();p.destroy()}}),endButton:new sap.m.Button({text:n.getText("LblCancelar"+
),press:function(){p.close()}}),afterClose:function(){p.destroy()},contentWidth:"60%"});p.open()},Estorno:function(e){let t=this.templateBaseExtension.getExtensionAPI();let n=this.templateBaseExtension.getExtensionAPI().getSelectedContexts();if(n.length>+
1){sap.m.MessageBox.error("Selecionar apenas uma linha");return}var a,i,o,s;for(let e of t.getSelectedContexts()){a=e.getObject().BR_NotaFiscal;i=e.getObject().bukrs;o="";s=""}var r="NotaFiscal";var l="monitor";var u={Docnum:a,Bukrs:i,DataDocInicio:o,Dat+
aDocFim:s};this.navigateTo(r,l,u)},navigateTo:function(e,t,n){sap.ushell.Container.getService("CrossApplicationNavigation").isNavigationSupported([{target:{shellHash:e+"-"+t}}]).done(function(a){a.map(function(a,i){if(a.supported===true){var o=sap.ushell+
&&sap.ushell.Container&&sap.ushell.Container.getService("CrossApplicationNavigation").hrefForExternal({target:{semanticObject:e,action:t},params:n});sap.m.URLHelper.redirect(o,false)}else{sap.m.MessageBox.warning("Usuário sem permissão para acessar o lin+
k")}})}).fail(function(){sap.m.MessageBox.error("Falha ao acessar o link")})},valueHelpBpCliente:function(e){this._oInputUfDestino=sap.ui.getCore().byId("inBpCliente");this.pWhitespaceDialog=new n.valueHelpContruct(e)},ValueHelpModalidaFrete:function(e){+
this._oInputUfDestino=sap.ui.getCore().byId("inModalidadeFrete");this.pWhitespaceDialog=new a.valueHelpContruct(e)},valueHelpBpCliente2:function(e){this._oInputUfDestino=sap.ui.getCore().byId("inAgente");this.pWhitespaceDialog=new n.valueHelpContruct(e)}+
,onValueHelpDialogOk:function(e){var t=this.pWhitespaceDialog.ValueHelpDialogOk(e);this._oInputUfDestino.getSource().setValue(t);this.onChangeMotivo(this._oInputUfDestino)},onValueHelpDialogPopUpRetornoRemessaOk:function(e){var t=this.pWhitespaceDialog.V+
alueHelpDialogOk(e);this._oInputUfDestino.setValue(t)},onValueHelpDialogCancel:function(e){this.pWhitespaceDialog.ValueHelpDialogCancel()},onFilterBarSearch:function(e){this.pWhitespaceDialog.Search(e)},onInputSuggestionItemSelected:function(e){this.pWhi+
tespaceDialog.SuggestionItemSelected(e)},onInputSuggestionItemSelected2:function(e){this.pWhitespaceDialog.SuggestionItemSelected(e)},onInputSuggestionItemSelected3:function(e){this.pWhitespaceDialog.SuggestionItemSelected(e)}}});                         
//# sourceMappingURL=ListReportExt.controller.js.map                                                                                                                                                                                                           